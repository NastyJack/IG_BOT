!function(){function n(n){const e=document.createElement("script");e.textContent=n.replace("<script>","(function () {").replace("<\/script>","})()"),document.documentElement.insertAdjacentElement("afterbegin",e),e.remove()}var e={createName:function(n,e){return`${n}|${JSON.stringify(e)}`},getName:t,getParams:function(){return function(n){try{return JSON.parse(n)}catch(n){return null}}(window.self.name.split("|")[1])||{}},isIframe:function(n=null){return window.self!==parent&&(!n||t()===n)}};function t(){return window.self.name.split("|")[0]||null}function r(n,e={}){const t=Math.random().toString().slice(2),r=document.createElement("script");r.onload=()=>r.remove(),r.src=chrome.runtime.getURL(`${n}?v=${t}`),document.documentElement.insertAdjacentElement("afterbegin",r);for(const n in e)r.setAttribute(n,e[n])}var i=document.documentElement,o={initForIg:function(){s(),n(`\n    <script>\n      const modulePatcher = window.inssist.modulePatcher\n      modulePatcher.onModuleInit((bodyStr, setBodyStr) => {\n        const isReact = (\n          bodyStr.includes('createElement:') &&\n          bodyStr.includes('Fragment:')\n        )\n        if (!isReact) { return }\n\n        const moduleVar = bodyStr.match(/(\\w+)\\.exports=/)[1]\n        if (!moduleVar) { return }\n\n        setBodyStr(\n          bodyStr + ';' +\n          'const __module__ = ' + moduleVar + ';' +\n          "${"\n    <script>\n      ;(() => {\n        const React = __module__.exports;\n        const emojiRegex = window.inssist.theme.emojiRegex;\n        const createElement = React.createElement.bind(React);\n        React.createElement = (...args) => {\n          const children = [].concat(args[2]);\n\n          let hasEmoji = false;\n          children.forEach((child, childIndex) => {\n            if (typeof child !== 'string') { return }\n\n            const emojis = (child.match(emojiRegex) || []).filter(e => !'0123456789#*'.includes(e));\n            if (emojis.length === 0) { return }\n\n            const newChildren = [];\n            let str = child;\n            emojis.forEach((emoji, emojiIndex) => {\n              if (!str.includes(emoji)) { return }\n              str = str.replace(emoji, '__@#$%^__');\n              const [before, after] = str.split('__@#$%^__');\n              if (before) {\n                newChildren.push(before);\n              }\n              const span = createElement('span', {\n                className: 'emoji',\n              }, emoji);\n              newChildren.push(span);\n              str = after;\n            });\n            if (str) {\n              newChildren.push(str);\n            }\n\n            hasEmoji = true;\n            children[childIndex] = newChildren;\n          });\n\n          if (hasEmoji) {\n            args[2] = children;\n          }\n\n          return createElement(...args);\n        }\n      })()\n    <\/script>\n  ".replace("<script>","").replace("<\/script>","").split("\n").join(" ")}"\n        )\n      })\n    <\/script>\n  `)},initForFcs:function(){s()}};function s(){n(`\n    <script>\n      window.inssist.theme.emojiRegex = ${window.emojiRegex.toString()}\n    <\/script>\n  `)}var a={initForIg:function(){l(),o.initForIg()},initForFcs:function(){l(),o.initForFcs()}};function l(){!function(){const n=e.getParams().theme;if(!n)return;i.classList.add(`theme-${n}`)}(),i.insertAdjacentHTML("afterbegin",'\n    <svg id="theme-night-svg" style="display: none; height: 0px; width: 0px;">\n      <filter id="theme-filter" x="0" y="0" width="99999" height="99999" style="color-interpolation-filters: srgb;">\n        <feColorMatrix type="matrix" values="0.300 -0.600 -0.600 0.000 0.950 -0.600 0.300 -0.600 0.000 0.950 -0.600 -0.600 0.300 0.000 0.950 0.000 0.000 0.000 1.000 0.000"></feColorMatrix>\n      </filter>\n      <filter id="theme-reverse-filter" x="0" y="0" width="99999" height="99999" style="color-interpolation-filters: srgb;">\n        <feColorMatrix type="matrix" values="0.333 -0.667 -0.667 0.000 1.000 -0.667 0.333 -0.667 0.000 1.000 -0.667 -0.667 0.333 0.000 1.000 0.000 0.000 0.000 1.000 0.000"></feColorMatrix>\n      </filter>\n    </svg>\n  '),i.insertAdjacentHTML("afterbegin",'\n    <style>\n      .theme-night {\n        filter: url(#theme-filter) !important;\n        text-shadow: 0 0 0 !important;\n        background: #191919 !important;\n      }\n\n      .theme-night ._cqw45._2pnef,\n      .theme-night ._mli86,\n      .theme-night :not(object):not(body)>embed,\n      .theme-night [background],\n      .theme-night [style*="background-image: url"],\n      .theme-night [style*="background-image:url"],\n      .theme-night [style*="background: url"],\n      .theme-night [style*="background:url"],\n      .theme-night img,\n      .theme-night object,\n      .theme-night svg image,\n      .theme-night video {\n        -webkit-filter: url(#theme-reverse-filter) !important;\n        filter: url(#theme-reverse-filter) !important;\n      }\n\n      .theme-night [background] *,\n      .theme-night [style*="background-image: url"] *,\n      .theme-night [style*="background-image:url"] *,\n      .theme-night [style*="background: url"] *,\n      .theme-night [style*="background:url"] *,\n      .theme-night img[src^="https://s0.wp.com/latex.php"],\n      .theme-night input .NaturalImage-image {\n        -webkit-filter: none !important;\n        filter: none !important;\n      }\n\n      .theme-night :-webkit-full-screen,\n      .theme-night :-webkit-full-screen * {\n        -webkit-filter: none !important;\n        filter: none !important;\n      }\n\n      .theme-night :-moz-full-screen,\n      .theme-night :-moz-full-screen * {\n        -webkit-filter: none !important;\n        filter: none !important;\n      }\n\n      .theme-night :fullscreen,\n      .theme-night :fullscreen * {\n        -webkit-filter: none !important;\n        filter: none !important;\n      }\n    </style>\n  ')}var c={init:function(){n("\n    <script>\n      window.inssist.schedule.requireModule = requireModule\n\n\n      async function requireModule (moduleName, maxWaitTime = null) {\n        return new Promise(resolve => {\n          let timeout\n          if (maxWaitTime) {\n            timeout = setTimeout(() => {\n              resolve(null)\n            }, maxWaitTime)\n          }\n\n          window.requireLazy([moduleName], module => {\n            clearTimeout(timeout)\n            resolve(module)\n          })\n        })\n      }\n    <\/script>\n  "),n("\n    <script>\n      const modulePatcher = window.inssist.modulePatcher\n      modulePatcher.onModuleInit(\n        ({ moduleName, args }) => {\n          // improve error logs\n          if (moduleName === 'ErrorBrowserConsole') {\n            window.requireLazy(['ErrorBrowserConsole'], errorBrowserConsole => {\n              errorBrowserConsole.errorListener = (error) => {\n                // ignore certain facebook errors\n                if (error.message.includes('GraphQL server responded with error 1675012')) { return }\n                if (error.message.includes('Graph API failed')) { return }\n                console.error('[fcs]', error.stack.trim(), '\\n', error.message)\n              }\n            })\n          }\n\n          // disable \"check out calender\" tooltip\n          if (moduleName === 'MediaManagerInstagramCalendarViewTabConfig') {\n            window.requireLazy(['MediaManagerInstagramCalendarViewTabConfig'], calendarTabConfig => {\n              calendarTabConfig.navItemPulseNUXConfig.isVisible = () => false\n            })\n          }\n        }\n      )\n    <\/script>\n  "),n("\n    <script>\n      const modulePatcher = window.inssist.modulePatcher\n      modulePatcher.onModuleInit(({ bodyStr, setBodyStr }) => {\n        if (!bodyStr.includes('window.top')) { return }\n        const newBodyStr = bodyStr.split('window.top').join('window')\n        setBodyStr(newBodyStr)\n      })\n    <\/script>\n  ")}};var d={init:function(){!function(){if(Array.prototype.flat)return;Array.prototype.flat=function(){const n=[...this],e=[];for(const t of n)Array.isArray(t)?e.push(...t):e.push(t);return e}}()}};var m={init:function(){n("\n    <script>\n      window.inssist.modulePatcher = {\n        // onModuleInit(({ moduleName, args, bodyStr, setBodyStr }) => {...})\n        onModuleInit,\n      }\n\n\n      const handlers = []\n\n\n      function onModuleInit (handler) {\n        handlers.push(handler)\n      }\n\n\n      // patch __d function so we can modify modules body\n      let __d\n      Object.defineProperty(Object.prototype, '__d', {\n        get () {\n          return (...args) => {\n            // check __d args\n            const fn = args[2]\n            if (typeof fn !== 'function') {\n              return __d(...args)\n            }\n\n            // extract module's function body as a string\n            const fnStr = fn.toString()\n            const argsStr = fnStr.split('(')[1].split(')')[0]\n            const bodyStartIndex = fnStr.indexOf('{')\n            const bodyEndIndex = fnStr.lastIndexOf('}')\n            let bodyStr = fnStr.slice(bodyStartIndex + 1, bodyEndIndex)\n\n            const setBodyStr = (newBodyStr) => {\n              bodyStr = newBodyStr\n              const newFn = new Function(argsStr, bodyStr)\n              args[2] = newFn\n            }\n\n            // call handlers which can modify current module\n            const moduleName = args[0]\n            handlers.forEach(handler => {\n              handler({\n                moduleName,\n                args,\n                bodyStr,\n                setBodyStr,\n              })\n            })\n\n            return __d(...args)\n          }\n        },\n        set (value) {\n          __d = value\n          return true\n        },\n      })\n    <\/script>\n  ")}};var u={init:function(){n("\n    <script>\n      const modulePatcher = window.inssist.modulePatcher\n\n\n      modulePatcher.onModuleInit(\n        ({ moduleName, bodyStr, setBodyStr }) => {\n          // ignore these modules because patching fails for them\n          if (\n            moduleName === 'ReactPropTransfererCore' ||\n            moduleName === 'TooltipData'\n          ) { return }\n\n          // generate class name\n          const className = moduleName\n            .replace('.react', '')\n            .split('.').join('_')\n\n          // add generated class name to className field\n          const newBodyStr = bodyStr\n            .replace(/className:([\"a-z][^?]{20})/g, 'className:\"' + className + ' \"+$1')\n\n          setBodyStr(newBodyStr)\n        }\n      )\n    <\/script>\n  ")}};function h(){n("\n    <script>\n      window.inssist = {\n        theme: {},\n        schedule: {},\n        modulePatcher: null,\n      }\n    <\/script>\n  ")}async function f(){if(window.opener&&"utils-window"===window.name&&(location.href.startsWith("https://business.facebook.com/business/loginpage/igoauth/callback")||location.href.startsWith("https://business.facebook.com/media_manager/instagram/oauthlink"))){const n=new URL(location.href).searchParams.get("code");window.opener.postMessage({name:"fb-api.connect-fcs",code:n},"*"),window.close()}}({init:function(){d.init(),h(),f(),a.initForFcs(),r("/fb-injection/index.js"),e.isIframe("inssist-fcs")&&(document.documentElement.insertAdjacentHTML("afterbegin",'\n    <link\n      href="https://fonts.googleapis.com/css?family=Montserrat:400,500,600,700|Nunito+Sans&display=fallback&subset=cyrillic,cyrillic-ext,latin-ext,vietnamese"\n      rel="stylesheet"/>\n  '),n("\n    <script>\n      document.write = function () {}\n    <\/script>\n  "),m.init(),u.init(),c.init())}}).init()}();